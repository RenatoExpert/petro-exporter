#!/bin/perl

use warnings;
use strict;

print("Step 1: Certificado de arqueacao \t (Pegando da aba 1)\n");
my $empresa;
my $datacert; 
#	Nome da certificadora
while(<>){
	if ($_ =~ s/Empresa:,//) {
		$empresa = $_;
		last;
	}
}
#	Data do certificado
while(<>){
	if ($_ =~ s/Certificado:,//) {
		$datacert = $_;
		last;
	}
}
$empresa =~ s/\n//;		# Cleaning, since its getting \n between terms
print ("$empresa $datacert");

print("Step 2: Altura util \t (Pegando da aba 2)\n");
my $alturautil;
my $contando_aneis;
my $segunda_aba;
my $aneis_counter = 0;
while(<>){
	# Ele começa a olhar as alturas depois de encontrar a palavra Altura NA SEGUNDA ABA!!
	if ($_ =~ /Altura/) {	
		if ($segunda_aba) {
			$contando_aneis = 1;
		}
		$segunda_aba = 1;
	} elsif ($contando_aneis) {
		# Sabemos que a sessão acaba quando aparece qualquer linha NAO começada com um numero
		if ($_ =~ m/^[0-9]/) {			
			$aneis_counter++;
			$alturautil = $_;
		} else {
			my @firstfield = split /,/, $alturautil;
			$alturautil = $firstfield[0];
			last;
		}
	}
}
print ("$alturautil\n"); # ... da aba 2

print("Step 3: Numero de aneis \t (Pegando da aba 2)\n");
print ("$aneis_counter\n"); # ... da aba 2

print("INSERT INTO tanques (certarqueacao, datacertificado, alturautil, numeroaneis) VALUES ($empresa, $datacert, $alturautil, $aneis_counter);";
